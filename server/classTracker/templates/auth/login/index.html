{% extends 'base.html'%}
{% block title %} SysWeb Login {% endblock %}

{% block content%}

<div class="wrapper m-5 d-flex justify-content-center">
   
   <div class="col-sm-12 col-md-5">
      <!-- jquery validation -->
      <div class="card card-primary">
        <div class="card-header">
          <h2 class="card-title">CloudTools - Login</h2>
        </div>
        <!-- /.card-header -->
        <!-- form start -->
         <form id="loginForm" method="POST" action="/login">
          <div class="card-body">
            <div class="form-group">
              <label for="exampleInputEmail1">Email</label>
              <input type="email" name="email" id="email" class="form-control" placeholder="Insira um email">
            </div>
            <div class="form-group">
              <label for="exampleInputPassword1">Password</label>
              <input type="password" name="password" class="form-control" id="password" placeholder="Password">
            </div>
            <div class="form-group mb-0">
               <div class="custom-control custom-checkbox">
                  <input type="checkbox" class="custom-control-input" id="seePass">
                  <label class="custom-control-label control-label-1" for="seePass">Mostrar Password</label>
               </div>
               <div class="custom-control custom-checkbox">
                  <input type="checkbox" class="custom-control-input" id="remember" name="remember">
                  <label class="custom-control-label control-label-1" for="remember">Lembrar Sessão</label>
               </div>
            </div>
          </div>
          <!-- /.card-body -->
          <div class="card-footer">
            <button type="submit" class="btn btn-primary">Login</button>
          </div>
        </form>
      </div>
      <!-- /.card -->
   </div>

   <script>

        document.addEventListener('DOMContentLoaded', function() {

            var seePass = document.getElementById("seePass")
            seePass.checked = false
            seePass.addEventListener("change", () => {
                if (seePass.checked) {
                    $("#password").attr("type", "text")

                } else {
                    $("#password").attr("type", "password")

                }
            })



            var form = $('#loginForm')[0]

            form.addEventListener('submit', function(event) {

               event.preventDefault(); // Prevent the default form submission

               // Create FormData object
               var formData = new FormData(form);

               // Send the form data via Fetch API
               fetch(form.action, {
                  method: form.method,
                  body: formData
               })
               .then(response => response.json())
               .then(data => {

                  if (data == "NotValid") {
                     Toast.fire({
                        icon: 'warning',
                        title: 'Dados de Login inválidos!'
                      })
                  }
                  if (data == "OK") {
                     window.location.href="/dashboard"
                  }
               })
               .catch(function(error) {
                  // Handle errors
                  console.error(error);
               });
                    

            });
        });
            
    </script>

{% endblock %}