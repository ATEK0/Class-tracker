{% extends 'base.html'%}
{% block title %} SysWeb Registo {% endblock %}

{% block content%}

<div class="wrapper m-5 d-flex justify-content-center">
   
   <div class="col-sm-12 col-md-5">
      <!-- jquery validation -->
      <div class="card card-primary">
        <div class="card-header">
          <h2 class="card-title">CloudTools - Registo</h2>
        </div>
        <!-- /.card-header -->
        <!-- form start -->
         <form id="registerUser" method="POST" action="/register">
          <div class="card-body">
            <div class="form-group">
                <label>Nome</label>
                <input class="form-control" id="name" maxlength="50" minlength="2" name="name" type="text" placeholder=" ">
            </div>
            <div class="form-group">
                <label>Sobrenome</label>
                <input class="form-control" id="surname" maxlength="50" minlength="2" name="surname" type="text" placeholder=" ">
            </div>
            <div class="form-group">
                <label>Email</label>
                <input class="form-control" id="email" maxlength="150" minlength="5" name="email" type="email" placeholder=" ">
            </div>
            <div class="form-group">
                <label>Password</label>
                <input class="form-control" id="password" minlength="8" name="password" type="password" placeholder="">
            </div>
            <div class="floating-label form-group">
                <label>Confirm Password</label>
                <input class="form-control" id="password2" minlength="8" name="password2" type="password" placeholder="">
            </div>
            <div class="custom-control custom-checkbox mb-3">
                <input type="checkbox" class="custom-control-input" id="seePass" checked="false">
                <label class="custom-control-label" for="seePass">Mostrar Password</label>
             </div>
          </div>
          <!-- /.card-body -->
          <div class="card-footer">
            <button type="submit" class="btn btn-primary">Registar</button>
          </div>
        </form>
      </div>
      <!-- /.card -->
   </div>

   <script>
    document.addEventListener('DOMContentLoaded', function() {
       //var form = document.querySelector('#registerUser');
       
       var seePass = document.getElementById("seePass")
       seePass.checked = false
 
       seePass.addEventListener("change", () => {
          if (seePass.checked) {
 
             $("#password").attr("type", "text")
             $("#password2").attr("type", "text")
          } else {
             $("#password").attr("type", "password")
             $("#password2").attr("type", "password")
          }
       })
 
 
 
       var form = $('#registerUser')[0]
 
       form.addEventListener('submit', function(event) {
 
          let checkPassword = /^(?=.*[A-Z])(?=.*[!@#$&_\-/?*])(?=.*[0-9])(?=.*[a-z]).{8,}$/
 
          var valid = 0
 
          event.preventDefault(); // Prevent the default form submission
    
          // Create FormData object
          var formData = new FormData(form);
 
                  
             
          if ($("#password").val() != $("#password2").val()) {
            //mostrar toast
            
 
          } else {
             if ($("#password").val().match(checkPassword)) {
 
                // Send the form data via Fetch API
                fetch(form.action, {
                   method: form.method,
                   body: formData
                })
                .then(response => response.json())
                .then(data => {
    
                   if (data == "OK") {
                      window.location.href="{{url_for('auth.login')}}"
                   }
                   if (data == "user exists") {
                    //mostrat toast
                }
                })
                .catch(function(error) {
                   // Handle errors
                   console.error(error);
                });
                
             } else {
                //mostrar toast
             }
          }          
       });
    });
    
 </script>

{% endblock %}